<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Site Asset & Script Scanner</title>
  <style>
    body{font-family:Inter,system-ui;max-width:960px;margin:24px auto;padding:12px}
    header{display:flex;justify-content:space-between;align-items:center}
    input,button,textarea{font-size:14px;padding:10px;margin:6px 0;width:100%}
    .row{display:flex;gap:8px}
    .card{border-radius:8px;padding:12px;margin:8px 0;background:#f7f7fb;border:1px solid #e2e2ee}
    pre{white-space:pre-wrap;word-break:break-word}
    .bad{color:#9b1c1c;font-weight:700}
    .good{color:#0b6b2f;font-weight:700}
  </style>
</head>
<body>
  <header>
    <h1>Site Asset & Script Scanner</h1>
    <small>Safe info-only scan — your own sites only.</small>
  </header>

  <div class="card">
    <label>Target URL (include https://)</label>
    <input id="target" placeholder="https://example.com" />

    <label>Backend API URL (where server.js is hosted)</label>
    <input id="api" placeholder="http://localhost:3000/scan" />

    <label>Optional: API Key (if your backend requires it)</label>
    <input id="apikey" placeholder="optional: paste key" />

    <div class="row">
      <button id="scanBtn">Start Scan</button>
      <button id="clearBtn" type="button">Clear</button>
    </div>

    <div id="status" style="margin-top:8px"></div>
  </div>

  <div id="results"></div>

<script>
const scanBtn = document.getElementById('scanBtn');
const clearBtn = document.getElementById('clearBtn');
const targetInput = document.getElementById('target');
const apiInput = document.getElementById('api');
const apikeyInput = document.getElementById('apikey');
const status = document.getElementById('status');
const results = document.getElementById('results');

clearBtn.onclick = () => {
  results.innerHTML = '';
  status.innerText = '';
};

scanBtn.onclick = async () => {
  results.innerHTML = '';
  status.innerText = 'Starting scan…';

  const target = targetInput.value.trim();
  const apiUrl = apiInput.value.trim();
  if (!target || !apiUrl) {
    status.innerText = 'Provide both target URL and backend API URL.';
    return;
  }

  status.innerText = 'Contacting backend…';
  try {
    const resp = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...(apikeyInput.value ? {'x-api-key': apikeyInput.value} : {})
      },
      body: JSON.stringify({ url: target })
    });

    if (!resp.ok) {
      const t = await resp.text();
      status.innerText = `Backend error: ${resp.status} - ${t}`;
      return;
    }

    status.innerText = 'Received analysis — rendering...';
    const data = await resp.json();
    renderResults(data);
    status.innerText = 'Done.';
  } catch (e) {
    status.innerText = 'Network error: ' + e.message;
  }
};

function renderResults(d) {
  const out = document.createElement('div');

  // summary
  const sum = document.createElement('div');
  sum.className = 'card';
  sum.innerHTML = `<h3>Summary</h3>
    <div>URL: <strong>${escapeHtml(d.url)}</strong></div>
    <div>Total scripts found: <strong>${d.scripts.length}</strong></div>
    <div>External assets: <strong>${d.external_assets.length}</strong></div>
    <div>Flags detected: <strong>${d.flags.length}</strong></div>
  `;
  out.appendChild(sum);

  // external assets
  const assets = document.createElement('div');
  assets.className = 'card';
  assets.innerHTML = `<h4>External Scripts & Assets</h4>`;
  const ul = document.createElement('ul');
  d.external_assets.forEach(a => {
    const li = document.createElement('li');
    li.innerHTML = `<code>${escapeHtml(a)}</code>`;
    ul.appendChild(li);
  });
  assets.appendChild(ul);
  out.appendChild(assets);

  // inline scripts
  const inline = document.createElement('div');
  inline.className = 'card';
  inline.innerHTML = `<h4>Inline scripts (showing first 800 chars each)</h4>`;
  d.inline_scripts.forEach((s, i) => {
    const pre = document.createElement('pre');
    pre.textContent = s.slice(0, 800) + (s.length>800 ? '\n\n...truncated...' : '');
    inline.appendChild(pre);
  });
  out.appendChild(inline);

  // flags
  const flags = document.createElement('div');
  flags.className = 'card';
  flags.innerHTML = `<h4>Detected Flags / Warnings</h4>`;
  if (d.flags.length === 0) {
    flags.innerHTML += `<div class="good">No obvious flags detected (manual review recommended).</div>`;
  } else {
    d.flags.forEach(f => {
      const p = document.createElement('div');
      p.innerHTML = `<div class="bad">• ${escapeHtml(f)}</div>`;
      flags.appendChild(p);
    });
  }
  out.appendChild(flags);

  // raw json (collapsible)
  const raw = document.createElement('div');
  raw.className = 'card';
  raw.innerHTML = `<details><summary>Raw JSON result</summary><pre>${escapeHtml(JSON.stringify(d, null, 2))}</pre></details>`;
  out.appendChild(raw);

  results.appendChild(out);
}

function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
</script>

</body>
</html>
